<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡ç®¡ç† - {{ service_name }} - tg2emall</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        .admin-sidebar {
            min-height: 100vh;
            background-color: #343a40;
        }
        .admin-sidebar .nav-link {
            color: #adb5bd;
        }
        .admin-sidebar .nav-link:hover,
        .admin-sidebar .nav-link.active {
            color: #fff;
            background-color: #495057;
        }
        .stats-card {
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- ä¾§è¾¹æ  -->
        <div class="col-md-3 col-lg-2 d-md-block admin-sidebar">
            <div class="position-sticky pt-3">
                <nav class="nav flex-column">
                    <h6 class="text-light mb-3">ç®¡ç†ä¸­å¿ƒ</h6>
                    <a class="nav-link" href="{{ url_for('admin_index') }}">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        æ§åˆ¶å°
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_articles') }}">
                        <i class="fas fa-list me-2"></i>
                        æ–‡ç« ç®¡ç†
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_config') }}">
                        <i class="fas fa-cogs me-2"></i>
                        é…ç½®ç®¡ç†
                    </a>
                    <a class="nav-link active" href="{{ url_for('admin_services') }}">
                        <i class="fas fa-server me-2"></i>
                        æœåŠ¡ç®¡ç†
                    </a>
                    <a class="nav-link" href="{{ url_for('telegram_verification') }}">
                        <i class="fab fa-telegram me-2"></i>
                        TelegraméªŒè¯
                    </a>
                    
                    <h6 class="text-light mt-4 mb-2">å…¶ä»–æ“ä½œ</h6>
                    <a class="nav-link" href="{{ url_for('index') }}">
                        <i class="fas fa-home me-2"></i>
                        è¿”å›å‰å°
                    </a>
                    <a class="nav-link" href="{{ url_for('admin_logout') }}">
                        <i class="fas fa-sign-out-alt me-2"></i>
                        é€€å‡ºç™»å½•
                    </a>
                </nav>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="col-md-10 p-4">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    {% if service_name == 'tgstate-management' %}
                        <i class="fas fa-cogs me-2"></i>å›¾ç‰‡ä¸Šä¼ ç®¡ç†æœåŠ¡
                    {% elif service_name == 'tgstate-service' %}
                        <i class="fas fa-image me-2"></i>å›¾ç‰‡ä¸Šä¼ æœåŠ¡
                    {% elif service_name == 'scraper-management' %}
                        <i class="fas fa-cogs me-2"></i>é‡‡é›†ç®¡ç†æœåŠ¡
                    {% elif service_name == 'scraper-service' %}
                        <i class="fas fa-download me-2"></i>é‡‡é›†æœåŠ¡
                    {% elif service_name in ['tgstate', 'tgstate-management', 'tgstate-service'] %}
                        <i class="fas fa-image me-2"></i>å›¾ç‰‡ä¸Šä¼ æœåŠ¡ç®¡ç†
                    {% elif service_name in ['scraper', 'scraper-management', 'scraper-service'] %}
                        <i class="fas fa-download me-2"></i>é‡‡é›†æœåŠ¡ç®¡ç†
                    {% endif %}
                </h2>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshStatus()">
                            <i class="fas fa-sync-alt me-1"></i>åˆ·æ–°çŠ¶æ€
                        </button>
                    </div>
                </div>
            </div>

            <!-- æœåŠ¡çŠ¶æ€å¡ç‰‡ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-info-circle me-2"></i>æœåŠ¡çŠ¶æ€
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="service-status">
                                {% if status.success %}
                                    <div class="alert alert-{% if status.status == 'running' %}success{% elif status.status == 'stopped' %}warning{% else %}danger{% endif %}">
                                        <h6 class="alert-heading">
                                            {% if status.status == 'running' %}
                                                <i class="fas fa-play-circle me-2"></i>è¿è¡Œä¸­
                                            {% elif status.status == 'stopped' %}
                                                <i class="fas fa-stop-circle me-2"></i>å·²åœæ­¢
                                            {% else %}
                                                <i class="fas fa-exclamation-triangle me-2"></i>å¼‚å¸¸
                                            {% endif %}
                                        </h6>
                                        <p class="mb-1">{{ status.message }}</p>
                                        {% if status.pid %}
                                            <small class="text-muted">PID: {{ status.pid }}</small>
                                        {% endif %}
                                    </div>
                                {% else %}
                                    <div class="alert alert-danger">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        æ— æ³•è·å–æœåŠ¡çŠ¶æ€: {{ status.message }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-cogs me-2"></i>æœåŠ¡æ§åˆ¶
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="btn-group-vertical w-100" role="group">
                                {% if status.success and status.status == 'running' %}
                                    <button type="button" class="btn btn-outline-danger mb-2" onclick="stopService()">
                                        <i class="fas fa-stop me-2"></i>åœæ­¢æœåŠ¡
                                    </button>
                                    <button type="button" class="btn btn-outline-warning mb-2" onclick="restartService()">
                                        <i class="fas fa-redo me-2"></i>é‡å¯æœåŠ¡
                                    </button>
                                    {% if service_name in ['scraper', 'scraper-management', 'scraper-service'] %}
                                        <hr class="my-2">
                                        <button type="button" class="btn btn-primary mb-2" onclick="startScrapingTask()">
                                            <i class="fas fa-robot me-2"></i>å¯åŠ¨é‡‡é›†ä»»åŠ¡
                                        </button>
                                        <small class="text-muted d-block mb-2">
                                            <i class="fas fa-info-circle me-1"></i>
                                            å¯åŠ¨Telegramé‡‡é›†ä»»åŠ¡ï¼ˆé¦–æ¬¡éœ€è¦éªŒè¯ï¼‰
                                        </small>
                                    {% endif %}
                                {% else %}
                                    <button type="button" class="btn btn-outline-success mb-2" onclick="startService()">
                                        <i class="fas fa-play me-2"></i>å¯åŠ¨æœåŠ¡
                                    </button>
                                {% endif %}
                                <button type="button" class="btn btn-outline-info" onclick="refreshStatus()">
                                    <i class="fas fa-sync-alt me-2"></i>åˆ·æ–°çŠ¶æ€
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æœåŠ¡é…ç½® -->
            {% if service_name in ['tgstate', 'tgstate-management', 'tgstate-service'] %}
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-cog me-2"></i>åŒæœåŠ¡æ¶æ„ä¿¡æ¯
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">
                                            <i class="fas fa-server me-2"></i>ç®¡ç†æœåŠ¡ (ç«¯å£8088)
                                        </h6>
                                        <p class="mb-1">è´Ÿè´£æ§åˆ¶ä¸Šä¼ æœåŠ¡çš„å¯åœå’Œé…ç½®ç®¡ç†</p>
                                        <small class="text-muted">çŠ¶æ€: è¿è¡Œä¸­ (è‡ªåŠ¨å¯åŠ¨)</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="alert alert-{% if status.success and status.status == 'running' %}success{% else %}warning{% endif %}">
                                        <h6 class="alert-heading">
                                            <i class="fas fa-upload me-2"></i>ä¸Šä¼ æœåŠ¡ (ç«¯å£8089)
                                        </h6>
                                        <p class="mb-1">ä¸“é—¨è´Ÿè´£å›¾ç‰‡ä¸Šä¼ åˆ°Telegramé¢‘é“</p>
                                        <small class="text-muted">
                                            çŠ¶æ€: {% if status.success and status.status == 'running' %}è¿è¡Œä¸­{% else %}å·²åœæ­¢{% endif %}
                                            {% if status.pid %} | PID: {{ status.pid }}{% endif %}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% elif service_name in ['scraper', 'scraper-management', 'scraper-service'] %}
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-cog me-2"></i>åŒæœåŠ¡æ¶æ„ä¿¡æ¯
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">
                                            <i class="fas fa-server me-2"></i>ç®¡ç†æœåŠ¡ (ç«¯å£5001)
                                        </h6>
                                        <p class="mb-1">è´Ÿè´£æ§åˆ¶é‡‡é›†æœåŠ¡çš„å¯åœå’Œé…ç½®ç®¡ç†</p>
                                        <small class="text-muted">çŠ¶æ€: è¿è¡Œä¸­ (è‡ªåŠ¨å¯åŠ¨)</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="alert alert-{% if status.success and status.status == 'running' %}success{% else %}warning{% endif %}">
                                        <h6 class="alert-heading">
                                            <i class="fas fa-download me-2"></i>é‡‡é›†æœåŠ¡ (ç«¯å£5002)
                                        </h6>
                                        <p class="mb-1">ä¸“é—¨è´Ÿè´£Telegramé¢‘é“æ¶ˆæ¯é‡‡é›†</p>
                                        <small class="text-muted">
                                            çŠ¶æ€: {% if status.success and status.status == 'running' %}è¿è¡Œä¸­{% else %}å·²åœæ­¢{% endif %}
                                            {% if status.pid %} | PID: {{ status.pid }}{% endif %}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% elif service_name == 'scraper' and config and config.success %}
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-cog me-2"></i>æœåŠ¡é…ç½®
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Telegram API ID</label>
                                        <input type="text" class="form-control" id="api_id" value="{{ config.data.api_id or '' }}" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Telegram API Hash</label>
                                        <input type="text" class="form-control" id="api_hash" value="{{ config.data.api_hash or '' }}" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">é‡‡é›†é¢‘é“</label>
                                        <textarea class="form-control" id="scrape_channels" rows="3" readonly>{{ config.data.scrape_channels or '' }}</textarea>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">é‡‡é›†æ•°é‡é™åˆ¶</label>
                                        <input type="number" class="form-control" id="scrape_limit" value="{{ config.data.scrape_limit or '10' }}" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">é‡‡é›†é—´éš”ï¼ˆç§’ï¼‰</label>
                                        <input type="number" class="form-control" id="scrape_interval" value="{{ config.data.scrape_interval or '300' }}" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">tgState URL</label>
                                        <input type="text" class="form-control" id="tgstate_url" value="{{ config.data.tgstate_url or '' }}" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                é…ç½®ä¿¡æ¯ä»æ•°æ®åº“åŠ¨æ€è¯»å–ï¼Œå¦‚éœ€ä¿®æ”¹è¯·å‰å¾€<a href="{{ url_for('admin_config') }}">é…ç½®ç®¡ç†</a>é¡µé¢ã€‚
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- æœåŠ¡ä¿¡æ¯ -->
            {% if service_name in ['tgstate', 'tgstate-management', 'tgstate-service'] %}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-info-circle me-2"></i>æœåŠ¡ä¿¡æ¯
                            </h5>
                        </div>
                        <div class="card-body">
            <div class="alert alert-info">
                <i class="fas fa-external-link-alt me-2"></i>
                å›¾ç‰‡ä¸Šä¼ æœåŠ¡ç®¡ç†é¡µé¢: <a href="http://{{ request.host.split(':')[0] }}:8088" target="_blank">http://{{ request.host.split(':')[0] }}:8088</a>
                <br><small class="text-muted">è¯¥é¡µé¢æä¾›è¯¦ç»†çš„æœåŠ¡ç®¡ç†å’Œé…ç½®åŠŸèƒ½</small>
            </div>
            <div class="alert alert-success">
                <i class="fas fa-upload me-2"></i>
                å›¾ç‰‡ä¸Šä¼ æµ‹è¯•é¡µé¢: <a href="https://img.237890.xyz" target="_blank">https://img.237890.xyz</a>
                <br><small class="text-muted">å…¬å¼€çš„å›¾ç‰‡ä¸Šä¼ æµ‹è¯•é¡µé¢ï¼Œéœ€è¦è¾“å…¥å¯†ç éªŒè¯</small>
            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% elif service_name in ['scraper', 'scraper-management', 'scraper-service'] %}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-info-circle me-2"></i>æœåŠ¡ä¿¡æ¯
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-external-link-alt me-2"></i>
                                é‡‡é›†æœåŠ¡ç®¡ç†é¡µé¢: <a href="http://{{ request.host.split(':')[0] }}:5001" target="_blank">http://{{ request.host.split(':')[0] }}:5001</a>
                                <br><small class="text-muted">è¯¥é¡µé¢æä¾›è¯¦ç»†çš„é‡‡é›†æœåŠ¡ç®¡ç†å’Œé…ç½®åŠŸèƒ½</small>
                            </div>
                            <div class="alert alert-success">
                                <i class="fas fa-download me-2"></i>
                                é‡‡é›†æœåŠ¡çŠ¶æ€é¡µé¢: <a href="http://{{ request.host.split(':')[0] }}:5002" target="_blank">http://{{ request.host.split(':')[0] }}:5002</a>
                                <br><small class="text-muted">é‡‡é›†æœåŠ¡çš„çŠ¶æ€ä¿¡æ¯å’Œå¥åº·æ£€æŸ¥</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
function showSweetAlert(title, content, icon) {
    Swal.fire({
        title: title,
        html: content,  // ä½¿ç”¨htmlå‚æ•°æ¥æ¸²æŸ“HTMLå†…å®¹
        icon: icon,
        confirmButtonText: 'ç¡®å®š',
        confirmButtonColor: icon === 'success' ? '#28a745' : 
                          icon === 'error' ? '#dc3545' : '#007bff',
        timer: icon === 'success' ? 2000 : null,
        timerProgressBar: icon === 'success' ? true : false,
        showConfirmButton: icon !== 'success'
    });
}

function startService() {
    Swal.fire({
        title: 'ç¡®è®¤å¯åŠ¨æœåŠ¡',
        text: 'ç¡®å®šè¦å¯åŠ¨{{ service_name }}æœåŠ¡å—ï¼Ÿ',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'ç¡®å®šå¯åŠ¨',
        cancelButtonText: 'å–æ¶ˆ',
        confirmButtonColor: '#28a745',
        cancelButtonColor: '#dc3545'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/admin/services/{{ service_name }}/start`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSweetAlert('æˆåŠŸ', data.message, 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showSweetAlert('å¤±è´¥', 'å¯åŠ¨å¤±è´¥: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showSweetAlert('é”™è¯¯', 'å¯åŠ¨å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            });
        }
    });
}

function stopService() {
    Swal.fire({
        title: 'ç¡®è®¤åœæ­¢æœåŠ¡',
        text: 'ç¡®å®šè¦åœæ­¢{{ service_name }}æœåŠ¡å—ï¼Ÿ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'ç¡®å®šåœæ­¢',
        cancelButtonText: 'å–æ¶ˆ',
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/admin/services/{{ service_name }}/stop`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSweetAlert('æˆåŠŸ', data.message, 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showSweetAlert('å¤±è´¥', 'åœæ­¢å¤±è´¥: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showSweetAlert('é”™è¯¯', 'åœæ­¢å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            });
        }
    });
}

function restartService() {
    Swal.fire({
        title: 'ç¡®è®¤é‡å¯æœåŠ¡',
        text: 'ç¡®å®šè¦é‡å¯{{ service_name }}æœåŠ¡å—ï¼Ÿ',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'ç¡®å®šé‡å¯',
        cancelButtonText: 'å–æ¶ˆ',
        confirmButtonColor: '#ffc107',
        cancelButtonColor: '#6c757d'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/admin/services/{{ service_name }}/restart`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSweetAlert('æˆåŠŸ', data.message, 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showSweetAlert('å¤±è´¥', 'é‡å¯å¤±è´¥: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showSweetAlert('é”™è¯¯', 'é‡å¯å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            });
        }
    });
}

// å¯åŠ¨é‡‡é›†ä»»åŠ¡
function startScrapingTask() {
    Swal.fire({
        title: '<div class="text-center"><i class="fas fa-robot fa-2x text-primary mb-2"></i><br>å¯åŠ¨é‡‡é›†ä»»åŠ¡</div>',
        html: '<div class="text-center">' +
              '<div class="mb-4">' +
              '<p class="mb-3">ğŸš€ å³å°†å¯åŠ¨Telegramé‡‡é›†ä»»åŠ¡</p>' +
              '<p class="text-muted">ç³»ç»Ÿå°†å¼€å§‹ä»æ‚¨é…ç½®çš„é¢‘é“è‡ªåŠ¨é‡‡é›†èµ„æº</p>' +
              '</div>' +
              '<div class="alert alert-warning border-warning">' +
              '<div class="d-flex align-items-center">' +
              '<i class="fas fa-exclamation-triangle fa-2x text-warning me-3"></i>' +
              '<div class="text-start">' +
              '<h6 class="mb-1 text-warning">âš ï¸ é‡è¦æç¤º</h6>' +
              '<small>é¦–æ¬¡è¿è¡Œéœ€è¦TelegraméªŒè¯ç </small>' +
              '</div>' +
              '</div>' +
              '</div>' +
              '<div class="alert alert-info border-info mt-3">' +
              '<div class="d-flex align-items-center">' +
              '<i class="fas fa-terminal fa-2x text-info me-3"></i>' +
              '<div class="text-start">' +
              '<h6 class="mb-1 text-info">ğŸ’» å¦‚éœ€è¾“å…¥éªŒè¯ç </h6>' +
              '<code class="bg-light p-1 rounded">docker attach tg2em-scrape</code>' +
              '</div>' +
              '</div>' +
              '</div>' +
              '</div>',
        icon: false,
        showCancelButton: true,
        confirmButtonText: '<i class="fas fa-play me-2"></i>å¯åŠ¨ä»»åŠ¡',
        cancelButtonText: '<i class="fas fa-times me-2"></i>å–æ¶ˆ',
        confirmButtonColor: '#28a745',
        cancelButtonColor: '#6c757d',
        width: '600px',
        customClass: {
            popup: 'swal-wide'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: '<div class="text-center"><i class="fas fa-cog fa-spin fa-2x text-primary mb-2"></i><br>æ­£åœ¨å¯åŠ¨...</div>',
                html: '<div class="text-center">' +
                      '<p class="mb-3">ğŸš€ æ­£åœ¨åˆå§‹åŒ–Telegramå®¢æˆ·ç«¯</p>' +
                      '<div class="spinner-border text-primary" role="status">' +
                      '<span class="visually-hidden">Loading...</span>' +
                      '</div>' +
                      '<p class="mt-3 text-muted">è¯·ç¨å€™ï¼Œè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ...</p>' +
                      '</div>',
                allowOutsideClick: false,
                showConfirmButton: false,
                width: '400px'
            });
            
            fetch(`/admin/services/{{ service_name }}/scrape/start`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                Swal.close();
                if (data.success) {
                    showSweetAlert('å¯åŠ¨æˆåŠŸ', 
                        '<div class="text-center">' +
                        '<div class="mb-3">' +
                        '<i class="fas fa-robot fa-3x text-success mb-3"></i>' +
                        '<h5 class="text-success mb-2">ğŸ‰ é‡‡é›†ä»»åŠ¡å¯åŠ¨æˆåŠŸï¼</h5>' +
                        '</div>' +
                        '<div class="alert alert-light border-success">' +
                        '<div class="row align-items-center">' +
                        '<div class="col-2 text-center">' +
                        '<i class="fas fa-check-circle fa-2x text-success"></i>' +
                        '</div>' +
                        '<div class="col-10">' +
                        '<h6 class="mb-1 text-success">ä»»åŠ¡çŠ¶æ€</h6>' +
                        '<small class="text-muted">ç³»ç»Ÿæ­£åœ¨ä»é…ç½®çš„é¢‘é“è‡ªåŠ¨é‡‡é›†èµ„æº</small>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '<div class="mt-3">' +
                        '<small class="text-muted">' +
                        '<i class="fas fa-info-circle me-1"></i>' +
                        'æ‚¨å¯ä»¥åœ¨æœåŠ¡æ—¥å¿—ä¸­æŸ¥çœ‹å®æ—¶é‡‡é›†è¿›åº¦' +
                        '</small>' +
                        '</div>' +
                        '</div>', 
                        'success');
                } else {
                    let errorMsg = data.message;
                    if (errorMsg.includes('éªŒè¯') || errorMsg.includes('ç™»å½•')) {
                        errorMsg = '<div class="text-center">' +
                                  '<div class="mb-3">' +
                                  '<i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>' +
                                  '<h5 class="text-warning mb-2">âš ï¸ éœ€è¦TelegraméªŒè¯</h5>' +
                                  '</div>' +
                                  '<div class="alert alert-warning border-warning mb-3">' +
                                  '<div class="d-flex align-items-center">' +
                                  '<i class="fas fa-info-circle fa-2x text-warning me-3"></i>' +
                                  '<div class="text-start">' +
                                  '<h6 class="mb-1 text-warning">ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h6>' +
                                  '<small>' + errorMsg + '</small>' +
                                  '</div>' +
                                  '</div>' +
                                  '</div>' +
                                  '<div class="alert alert-info border-info">' +
                                  '<div class="d-flex align-items-center">' +
                                  '<i class="fas fa-terminal fa-2x text-info me-3"></i>' +
                                  '<div class="text-start">' +
                                  '<h6 class="mb-1 text-info">ğŸ’» ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¾“å…¥éªŒè¯ç </h6>' +
                                  '<code class="bg-light p-2 rounded d-block mt-2">docker attach tg2em-scrape</code>' +
                                  '</div>' +
                                  '</div>' +
                                  '</div>' +
                                  '</div>';
                    } else {
                        errorMsg = '<div class="text-center">' +
                                  '<div class="mb-3">' +
                                  '<i class="fas fa-times-circle fa-3x text-danger mb-3"></i>' +
                                  '<h5 class="text-danger mb-2">âŒ å¯åŠ¨å¤±è´¥</h5>' +
                                  '</div>' +
                                  '<div class="alert alert-danger border-danger">' +
                                  '<div class="d-flex align-items-center">' +
                                  '<i class="fas fa-exclamation-triangle fa-2x text-danger me-3"></i>' +
                                  '<div class="text-start">' +
                                  '<h6 class="mb-1 text-danger">é”™è¯¯ä¿¡æ¯</h6>' +
                                  '<small>' + errorMsg + '</small>' +
                                  '</div>' +
                                  '</div>' +
                                  '</div>' +
                                  '</div>';
                    }
                    showSweetAlert('å¯åŠ¨å¤±è´¥', errorMsg, 'error');
                }
            })
            .catch(error => {
                Swal.close();
                console.error('Error:', error);
                showSweetAlert('ç½‘ç»œé”™è¯¯', 
                    '<div class="text-center">' +
                    '<div class="mb-3">' +
                    '<i class="fas fa-wifi fa-3x text-danger mb-3"></i>' +
                    '<h5 class="text-danger mb-2">ğŸŒ ç½‘ç»œè¿æ¥å¤±è´¥</h5>' +
                    '</div>' +
                    '<div class="alert alert-danger border-danger">' +
                    '<div class="d-flex align-items-center">' +
                    '<i class="fas fa-exclamation-triangle fa-2x text-danger me-3"></i>' +
                    '<div class="text-start">' +
                    '<h6 class="mb-1 text-danger">è¿æ¥é—®é¢˜</h6>' +
                    '<small>æ— æ³•è¿æ¥åˆ°é‡‡é›†æœåŠ¡ï¼Œè¯·æ£€æŸ¥æœåŠ¡çŠ¶æ€åé‡è¯•</small>' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '</div>', 
                    'error');
            });
        }
    });
}

function refreshStatus() {
    location.reload();
}
</script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

{% extends "admin/base.html" %}

{% block title %}个人资料{% endblock %}

{% block page_header %}
<div class="page-header py-3">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="h3 mb-0">个人资料</h1>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- 修改密码 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-key me-2"></i>修改密码</h5>
            </div>
            <div class="card-body">
                <form id="changePasswordForm">
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">当前密码 *</label>
                        <input type="password" class="form-control" id="currentPassword" name="current_password" 
                               placeholder="请输入当前密码" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">新密码 *</label>
                        <input type="password" class="form-control" id="newPassword" name="new_password" 
                               placeholder="请输入新密码（至少6位）" required minlength="6">
                    </div>
                    
                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">确认新密码 *</label>
                        <input type="password" class="form-control" id="confirmPassword" name="confirm_password" 
                               placeholder="请再次输入新密码" required>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>修改密码
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- 用户信息 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-user me-2"></i>个人信息</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <th>用户名:</th>
                        <td><strong>{{ user.username }}</strong></td>
                    </tr>
                    <tr>
                        <th>角色:</th>
                        <td><span class="badge bg-primary">管理员</span></td>
                    </tr>
                    <tr>
                        <th>登录状态:</th>
                        <td><span class="badge bg-success">已登录</span></td>
                    </tr>
                </table>
                
                <hr>
                
                <h6><i class="fas fa-info-circle me-2"></i>安全提示</h6>
                <ul class="list-unstyled text-muted small">
                    <li><i class="fas fa-check text-success me-1"></i>定期修改密码</li>
                    <li><i class="fas fa-check text-success me-1"></i>不要与他人分享密码</li>
                    <li><i class="fas fa-check text-success me-1"></i>使用强密码</li>
                    <li><i class="fas fa-check text-success me-1"></i>定期检查系统日志</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
    // 密码表单提交
    $('#changePasswordForm').submit(function(e) {
        e.preventDefault();
        
        var formData = new FormData(this);
        
        $.ajax({
            url: '/admin/change_password',
            method: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(data) {
                if (data.success) {
                    alert('密码修改成功！');
                    $('#changePasswordForm')[0].reset();
                } else {
                    alert('密码修改失败: ' + data.message);
                }
            },
            error: function() {
                alert('网络错误，请重试。');
            }
        });
    });
    
    // 密码确认验证
    $('#confirmPassword').on('input', function() {
        var newPassword = $('#newPassword').val();
        var confirmPassword = $(this).val();
        
        if (confirmPassword !== newPassword) {
            this.setCustomValidity('两次输入的密码不一致');
        } else {
            this.setCustomValidity('');
        }
    });
});
</script>
{% endblock %}

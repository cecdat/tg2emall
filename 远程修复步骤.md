# 远程服务器快速修复步骤

## 🚀 一键修复（推荐）

SSH 连接到您的 Debian 12 服务器后，执行以下命令：

```bash
# 1. 进入项目目录
cd /path/to/tg2emall

# 2. 拉取最新修复代码
git pull

# 3. 运行修复脚本
chmod +x fix_tgstate_remote.sh
./fix_tgstate_remote.sh
```

**就这么简单！** 脚本会自动完成所有修复步骤。

---

## 📋 手动修复（如果脚本失败）

```bash
# 1. 进入项目目录
cd /path/to/tg2emall

# 2. 停止旧容器
docker-compose stop tgstate
docker-compose rm -f tgstate

# 3. 重新构建（应用修复）
docker-compose build --no-cache tgstate

# 4. 启动服务
docker-compose up -d tgstate

# 5. 查看日志
docker-compose logs -f tgstate
```

---

## ✅ 验证修复

```bash
# 测试管理 API
curl http://localhost:8001/api/management/status

# 预期返回：
# {"success":true,"data":{"status":"stopped",...}}
```

---

## 🔍 查看状态

```bash
# 查看容器状态
docker-compose ps tgstate

# 查看实时日志
docker-compose logs -f tgstate

# 从前端容器测试连接
docker exec -it tg2em-frontend curl http://tgstate:8001/api/management/status
```

---

## 📚 详细文档

- [完整修复指南](./REMOTE_FIX_GUIDE.md) - 详细的故障排查和修复步骤
- [服务启动指南](./START_SERVICES.md) - 服务启动和管理

---

## ❓ 常见问题

### 端口 8001 被占用？

```bash
# 查看占用进程
netstat -tlnp | grep 8001

# 停止占用进程或修改 docker-compose.yml 端口映射
ports:
  - "8003:8001"  # 改用 8003 端口
```

### 容器启动后立即退出？

```bash
# 查看详细日志
docker-compose logs tgstate

# 检查环境变量配置
cat .env
```

### Git 拉取有冲突？

```bash
# 暂存本地修改
git stash

# 拉取代码
git pull

# 恢复本地修改（如果需要）
git stash pop
```

---

## 🆘 需要帮助？

如果修复失败，请收集以下信息：

```bash
# 生成诊断报告
{
  echo "=== 系统信息 ==="
  uname -a
  echo ""
  echo "=== Docker 版本 ==="
  docker --version
  docker-compose --version
  echo ""
  echo "=== 容器状态 ==="
  docker-compose ps
  echo ""
  echo "=== 服务日志 ==="
  docker-compose logs --tail=50 tgstate
} > diagnostic_report.txt

# 查看报告
cat diagnostic_report.txt
```

将诊断报告发送给技术支持。

